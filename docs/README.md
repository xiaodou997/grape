# Grape å¼€å‘æ–‡æ¡£

> ğŸ‡ Grape - è½»ç›ˆå¦‚é£çš„ä¼ä¸šçº§ç§æœ‰ npm ä»“åº“

## ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [å¼€å‘è·¯çº¿å›¾](#å¼€å‘è·¯çº¿å›¾)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ¨¡å—è¯´æ˜](#æ¨¡å—è¯´æ˜)

---

## é¡¹ç›®æ¦‚è¿°

### æ„¿æ™¯

Grape æ—¨åœ¨æ‰“é€ ä¸€ä¸ª**æè‡´è½»é‡ã€ä¼ä¸šå°±ç»ª**çš„ç§æœ‰ npm ä»“åº“ã€‚ç”¨ Go é‡å†™ï¼Œåœ¨ä¿æŒå®Œç¾å…¼å®¹ npm/yarn/pnpm/bun å®¢æˆ·ç«¯çš„åŒæ—¶ï¼Œæä¾›æ¯” Verdaccio æ›´å¼ºå¤§çš„æƒé™æ§åˆ¶ã€æ›´ç°ä»£åŒ–çš„ Web ç•Œé¢ã€æ›´ä½çš„èµ„æºå ç”¨ã€‚

### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| å•ä¸€äºŒè¿›åˆ¶ | æ— éœ€å®‰è£… Node.jsï¼Œä¸‹è½½å³ç”¨ |
| ä½å†…å­˜å ç”¨ | < 5MBï¼Œè¿œä½äº Verdaccio (~20MB) |
| æ™ºèƒ½ä»£ç† | è‡ªåŠ¨ç¼“å­˜å…¬å…±åŒ…ï¼ŒåŠ é€Ÿå›¢é˜Ÿå¼€å‘ |
| æƒé™æ§åˆ¶ | RBAC æ¨¡å‹ï¼Œç²¾ç»†åŒ–æƒé™ç®¡ç† |
| ç°ä»£åŒ– UI | Vue 3 + Element Plus |

### ä¸ Verdaccio å¯¹æ¯”

| ç»´åº¦ | Grape | Verdaccio |
|------|-------|-----------|
| æŠ€æœ¯æ ˆ | Go | Node.js |
| å†…å­˜å ç”¨ | < 5MB | ~ 20MB |
| å¹¶å‘èƒ½åŠ› | é«˜ (goroutine) | ä¸­ (å•çº¿ç¨‹) |
| æƒé™æ¨¡å‹ | RBAC + Web ç®¡ç† | ç®€å• ACL + é…ç½®æ–‡ä»¶ |
| Web UI | Vue 3 + Element Plus | å†…ç½®ç®€å• UI |

---

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph Clients
        N[npm]
        Y[yarn]
        P[pnpm]
        B[bun]
    end
    
    subgraph Grape
        API[HTTP API Server]
        REG[Registry Core]
        AUTH[Auth Module]
        STORE[Storage Layer]
    end
    
    subgraph Storage
        FS[æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ]
        CACHE[å…ƒæ•°æ®ç¼“å­˜]
    end
    
    subgraph External
        UPSTREAM[å…¬å…± npm ä»“åº“]
    end
    
    Clients --> API
    API --> REG
    API --> AUTH
    REG --> STORE
    REG --> UPSTREAM
    STORE --> FS
    STORE --> CACHE
```

### è¯·æ±‚å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant C as npm client
    participant G as Grape Server
    participant S as Local Storage
    participant U as Upstream

    C->>G: GET /lodash
    G->>S: æ£€æŸ¥æœ¬åœ°ç¼“å­˜
    
    alt æœ¬åœ°å­˜åœ¨
        S-->>G: è¿”å›å…ƒæ•°æ®
    else æœ¬åœ°ä¸å­˜åœ¨
        G->>U: è¯·æ±‚ä¸Šæ¸¸
        U-->>G: è¿”å›å…ƒæ•°æ®
        G->>S: ç¼“å­˜å…ƒæ•°æ®
    end
    
    G-->>C: è¿”å›åŒ…ä¿¡æ¯
    
    C->>G: GET /lodash/-/lodash-4.17.21.tgz
    G->>S: æ£€æŸ¥æœ¬åœ°æ–‡ä»¶
    
    alt æœ¬åœ°å­˜åœ¨
        S-->>G: è¿”å›æ–‡ä»¶
    else æœ¬åœ°ä¸å­˜åœ¨
        G->>U: ä¸‹è½½ tarball
        U-->>G: è¿”å›æ–‡ä»¶
        G->>S: ç¼“å­˜æ–‡ä»¶
    end
    
    G-->>C: è¿”å› tarball
```

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|----------|------|
| åç«¯è¯­è¨€ | Go 1.21+ | é«˜æ€§èƒ½ã€å¹¶å‘ã€å•ä¸€äºŒè¿›åˆ¶ |
| Web æ¡†æ¶ | Gin | é«˜æ€§èƒ½ã€ä¸­é—´ä»¶ä¸°å¯Œ |
| é…ç½®ç®¡ç† | Viper | æ”¯æŒå¤šç§é…ç½®æ ¼å¼ |
| æ—¥å¿— | Zap | é«˜æ€§èƒ½ç»“æ„åŒ–æ—¥å¿— |
| è®¤è¯ | JWT | æ— çŠ¶æ€è®¤è¯ |
| å‰ç«¯æ¡†æ¶ | Vue 3 + TypeScript | ç°ä»£åŒ–å“åº”å¼æ¡†æ¶ |
| UI ç»„ä»¶ | Element Plus | Vue 3 ç»„ä»¶åº“ |
| çŠ¶æ€ç®¡ç† | Pinia | Vue 3 å®˜æ–¹çŠ¶æ€ç®¡ç† |
| æ„å»ºå·¥å…· | Vite | æé€Ÿå¼€å‘ä½“éªŒ |

---

## å¼€å‘è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¡†æ¶ (å·²å®Œæˆ âœ…)

- [x] Go é¡¹ç›®éª¨æ¶æ­å»º
- [x] Viper é…ç½®ç®¡ç† + Zap æ—¥å¿—
- [x] Gin Web æ¡†æ¶ + åŸºç¡€è·¯ç”±
- [x] å¥åº·æ£€æŸ¥ API
- [x] npm åŒ…å…ƒæ•°æ®ä»£ç†
- [x] tarball ä¸‹è½½ä»£ç†
- [x] æœ¬åœ°ç¼“å­˜æœºåˆ¶
- [x] éªŒè¯ï¼šnpm install æˆåŠŸ

### é˜¶æ®µäºŒï¼šå‘å¸ƒèƒ½åŠ› (è¿›è¡Œä¸­ ğŸš§)

- [ ] ç”¨æˆ·è®¤è¯åŸºç¡€ï¼ˆå†…å­˜ç”¨æˆ· + JWTï¼‰
- [ ] npm login æµç¨‹
- [ ] npm publish å‘å¸ƒåŒ…
- [ ] npm unpublish æ’¤é”€å‘å¸ƒ
- [ ] éªŒè¯ï¼šå‘å¸ƒç§æœ‰åŒ…æˆåŠŸ

### é˜¶æ®µä¸‰ï¼šå‰ç«¯å®Œå–„ (å·²å®Œæˆ âœ…)

- [x] Vite + Vue 3 + TypeScript é¡¹ç›®
- [x] ç™»å½•é¡µé¢
- [x] åŒ…æµè§ˆé¡µé¢
- [x] åŒ…è¯¦æƒ…é¡µé¢
- [x] ç”¨æˆ·ç®¡ç†é¡µé¢
- [x] ç³»ç»Ÿè®¾ç½®é¡µé¢

### é˜¶æ®µå››ï¼šé›†æˆéƒ¨ç½² (å¾…å¼€å§‹)

- [ ] Go åµŒå…¥å‰ç«¯é™æ€èµ„æº
- [ ] å•ä¸€äºŒè¿›åˆ¶éƒ¨ç½²
- [ ] Docker é•œåƒ

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21+
- Node.js 18+ (ä»…å‰ç«¯å¼€å‘éœ€è¦)

### åç«¯å¯åŠ¨

```bash
# æ„å»º
make build

# è¿è¡Œ
./bin/grape

# æˆ–ä½¿ç”¨é…ç½®æ–‡ä»¶
./bin/grape -c ./configs/config.yaml
```

### å‰ç«¯å¯åŠ¨

```bash
cd web
npm install
npm run dev
```

### é…ç½® npm ä½¿ç”¨ Grape

```bash
# è®¾ç½® registry
npm set registry http://localhost:4873

# å®‰è£…åŒ…
npm install lodash

# æ¢å¤é»˜è®¤
npm set registry https://registry.npmjs.org
```

---

## æ¨¡å—è¯´æ˜

| æ¨¡å— | è·¯å¾„ | èŒè´£ |
|------|------|------|
| config | `internal/config/` | é…ç½®åŠ è½½å’Œç®¡ç† |
| logger | `internal/logger/` | æ—¥å¿—å°è£… |
| server | `internal/server/` | HTTP æœåŠ¡å™¨å’Œè·¯ç”± |
| registry | `internal/registry/` | npm registry æ ¸å¿ƒé€»è¾‘ |
| storage | `internal/storage/` | å­˜å‚¨æŠ½è±¡å±‚ |
| web | `web/` | å‰ç«¯é¡¹ç›® |

è¯¦ç»†æ¨¡å—æ–‡æ¡£è¯·å‚é˜…å„å­ç›®å½•ä¸‹çš„ READMEã€‚
