# 任务清单

## v0.1.0 完成情况 (2026-02-26)

### ✅ 已完成

| # | 任务 | 优先级 | 说明 |
|---|------|--------|------|
| 1 | 搭建 Go 项目骨架 | 🔴 高 | go.mod、目录结构 |
| 2 | 配置 Viper + Zap | 🔴 高 | 配置管理、日志系统 |
| 3 | 搭建 Gin 框架 | 🔴 高 | HTTP 服务器、路由 |
| 4 | 健康检查 API | 🔴 高 | GET /-/health |
| 5 | npm 包元数据代理 | 🔴 高 | GET /:package |
| 6 | tarball 下载代理 | 🔴 高 | GET /:package/-/:filename |
| 7 | 本地缓存机制 | 🔴 高 | 文件系统存储 |
| 8 | npm install 验证 | 🔴 高 | ✅ 成功安装包 |
| 9 | 用户认证基础 | 🟡 中 | JWT + SQLite 用户存储 |
| 10 | npm login 流程 | 🟡 中 | PUT /-/user/:username |
| 11 | npm publish | 🟡 中 | PUT /:package |
| 12 | npm unpublish | 🟡 中 | DELETE /:package |
| 13 | 发布私有包验证 | 🟡 中 | ✅ 成功发布和安装 |
| 14 | 搭建前端项目 | 🟡 中 | Vite + Vue 3 + TS + Element Plus |
| 15 | 登录页面 | 🟡 中 | 用户登录界面 |
| 16 | 包浏览页面 | 🟡 中 | 包列表展示 |
| 17 | 包详情页面 | 🟡 中 | 版本信息、依赖 |
| 18 | 用户管理页面 | 🟢 低 | 管理后台 |
| 19 | 系统设置页面 | 🟢 低 | 配置管理 |
| 20 | Go 嵌入前端资源 | 🟢 低 | 单一二进制部署 |
| 21 | 创建文档目录 | 🔴 高 | docs/ |
| 22 | 包列表 API | 🟡 中 | GET /-/api/packages |

### ✅ P0 紧急修复 (2026-02-26)

| # | 任务 | 状态 |
|---|------|------|
| P0-1 | 前端 axios 注入 JWT | ✅ |
| P0-2 | 管理后台页面与后端 API 联调 | ✅ |
| P0-3 | 用户数据持久化（SQLite） | ✅ |
| P0-4 | scoped 包列表逻辑修复 | ✅ |
| P0-5 | 前端 baseURL 同源修复 | ✅ |

### ✅ P1 重要优化 (2026-02-26)

| # | 任务 | 状态 |
|---|------|------|
| P1-6 | 默认安全配置强化（登录限流 + JWT 警告） | ✅ |
| P1-7 | 包发布并发安全保护 | ✅ |
| P1-8 | 存储层接口抽象 | ✅ |
| P1-9 | 错误响应格式统一 | ✅ |
| P1-10 | 补全自动化测试 | ✅ |

### ✅ 新增功能 (2026-02-26)

| # | 任务 | 说明 |
|---|------|------|
| 多上游支持 | 按 scope 路由到不同上游仓库 |
| 包管理器兼容 | npm/yarn/pnpm/bun 全支持 |
| 上游配置 API | GET /-/api/upstreams |
| 统计信息增强 | 包含上游配置信息 |

---

## 后续版本规划

### v0.2.0 - 权限增强

| # | 任务 | 优先级 | 状态 |
|---|------|--------|------|
| 1 | RBAC 权限模型 | 🟡 中 | 待开始 |
| 2 | 角色管理 | 🟡 中 | 待开始 |
| 3 | 包作用域权限 | 🟡 中 | 待开始 |
| 4 | 操作审计日志 | 🟡 中 | 待开始 |
| 5 | PostgreSQL 支持 | 🟡 中 | 待开始 |

### v0.3.0 - 性能优化

| # | 任务 | 优先级 | 状态 |
|---|------|--------|------|
| 1 | Redis 缓存 | 🟡 中 | 待开始 |
| 2 | S3/MinIO 存储 | 🟢 低 | 待开始 |
| 3 | 垃圾回收机制 | 🟢 低 | 待开始 |
| 4 | 性能压测优化 | 🟡 中 | 待开始 |

### v1.0.0 - 生产就绪

| # | 任务 | 优先级 | 状态 |
|---|------|--------|------|
| 1 | LDAP/OIDC 集成 | 🟢 低 | 待开始 |
| 2 | 高可用集群 | 🟢 低 | 待开始 |
| 3 | Webhook 通知 | 🟢 低 | 待开始 |
| 4 | 包安全扫描 | 🟢 低 | 待开始 |
| 5 | Prometheus 指标 | 🟢 低 | 待开始 |
| 6 | Docker 镜像 | 🟡 中 | 待开始 |
| 7 | Helm Chart | 🟢 低 | 待开始 |

---

## 技术栈

### 后端
- **语言**: Go 1.21+
- **框架**: Gin
- **配置**: Viper
- **日志**: Zap
- **认证**: JWT (golang-jwt/jwt)
- **数据库**: GORM + SQLite

### 前端
- **构建**: Vite
- **框架**: Vue 3 + TypeScript
- **UI**: Element Plus
- **状态**: Pinia
- **路由**: Vue Router

### 存储
- **数据库**: SQLite (支持 PostgreSQL 扩展)
- **元数据**: 文件系统 (JSON)
- **Tarball**: 文件系统

---

## 测试覆盖

### 单元测试

| 模块 | 测试文件 | 状态 |
|------|---------|------|
| auth | user_test.go | ✅ 5 个用例 |
| auth | jwt_test.go | ✅ 3 个用例 |
| storage | storage_test.go | ✅ 5 个用例 |

### 运行测试

```bash
# 运行所有测试
go test ./... -v

# 运行覆盖率
go test ./... -cover
```

---

## 更新日志

### 2026-02-26

**新增功能:**
- 多上游配置支持，按 scope 路由
- SQLite 数据库持久化
- 登录限流保护
- 包发布并发锁
- 上游配置 API

**修复问题:**
- 前端 JWT token 注入
- scoped 包列表显示
- baseURL 硬编码问题
- 管理后台 API 联调

**优化改进:**
- 存储层接口抽象
- 统一错误响应格式
- 补充单元测试
- 完善项目文档
