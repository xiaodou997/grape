å¤ªå¥½äº†ï¼**Grape** æ­£å¼è¯ç”Ÿï¼ğŸ‡

è¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„åå­—ï¼Œç®€æ´æœ‰åŠ›ï¼Œå¯“æ„ä¸°å¯Œã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ç³»ç»Ÿæ€§åœ°è§„åˆ’è¿™ä¸ªé¡¹ç›®ã€‚æˆ‘å°†æŒ‰ç…§**ä»0åˆ°1**çš„é¡ºåºï¼Œå¸®ä½ æ¢³ç†ä¸€ä¸ªå®Œæ•´çš„å¼€æºé¡¹ç›®å¯åŠ¨è“å›¾ã€‚

---

# ğŸ‡ Grape - ä¼ä¸šçº§ç§æœ‰npmä»“åº“ï¼ˆGoå®ç°ï¼‰

## ğŸ“‹ é¡¹ç›®è§„åˆ’ç›®å½•

1. [é¡¹ç›®å®šä½ä¸æ„¿æ™¯](#1-é¡¹ç›®å®šä½ä¸æ„¿æ™¯)
2. [æ ¸å¿ƒåŠŸèƒ½çŸ©é˜µ](#2-æ ¸å¿ƒåŠŸèƒ½çŸ©é˜µ)
3. [æŠ€æœ¯æ¶æ„è®¾è®¡](#3-æŠ€æœ¯æ¶æ„è®¾è®¡)
4. [æ¨¡å—åˆ’åˆ†ä¸APIè®¾è®¡](#4-æ¨¡å—åˆ’åˆ†ä¸apiè®¾è®¡)
5. [æ•°æ®æ¨¡å‹è®¾è®¡](#5-æ•°æ®æ¨¡å‹è®¾è®¡)
6. [å¼€å‘è·¯çº¿å›¾](#6-å¼€å‘è·¯çº¿å›¾)
7. [ç¤¾åŒºä¸å¼€æºç­–ç•¥](#7-ç¤¾åŒºä¸å¼€æºç­–ç•¥)
8. [å“ç‰Œä¸è§†è§‰è®¾è®¡](#8-å“ç‰Œä¸è§†è§‰è®¾è®¡)
9. [é‡Œç¨‹ç¢‘ä¸å‘å¸ƒè®¡åˆ’](#9-é‡Œç¨‹ç¢‘ä¸å‘å¸ƒè®¡åˆ’)

---

## 1. é¡¹ç›®å®šä½ä¸æ„¿æ™¯

### é¡¹ç›®æ ‡è¯­
```markdown
ğŸ‡ Grape - è½»ç›ˆå¦‚é£çš„ä¼ä¸šçº§ç§æœ‰npmä»“åº“

One binary, zero debt. ä¸€ä¸ªäºŒè¿›åˆ¶ï¼Œé›¶è´Ÿæ‹…ã€‚
```

### æ„¿æ™¯é™ˆè¿°
> Grape æ—¨åœ¨æ‰“é€ ä¸€ä¸ª**æè‡´è½»é‡ã€ä¼ä¸šå°±ç»ª**çš„ç§æœ‰npmä»“åº“ã€‚å®ƒç”¨Goé‡å†™ï¼Œåœ¨ä¿æŒå®Œç¾å…¼å®¹npm/yarn/pnpm/bunå®¢æˆ·ç«¯çš„åŒæ—¶ï¼Œæä¾›æ¯”Verdaccioæ›´å¼ºå¤§çš„æƒé™æ§åˆ¶ã€æ›´ç°ä»£åŒ–çš„Webç•Œé¢ã€æ›´ä½çš„èµ„æºå ç”¨ã€‚è®©ä¼ä¸šæ‹¥æœ‰è‡ªå·±çš„"npmç§æœ"ï¼Œåƒåƒè‘¡è„ä¸€æ ·ç®€å•ã€‚

### ç›®æ ‡ç”¨æˆ·
- **ä¸­å°å›¢é˜Ÿ**ï¼šéœ€è¦å¿«é€Ÿæ­å»ºç§æœ‰ä»“åº“ï¼Œä½†ä¸æƒ³ç»´æŠ¤å¤æ‚çš„Node.jsç”Ÿæ€
- **å¤§å‹ä¼ä¸š**ï¼šéœ€è¦ç²¾ç»†çš„æƒé™æ§åˆ¶ã€å®¡è®¡æ—¥å¿—ã€é«˜å¯ç”¨éƒ¨ç½²
- **Goè¯­è¨€çˆ±å¥½è€…**ï¼šå¸Œæœ›å‚ä¸ä¸€ä¸ªæœ‰æ„æ€çš„Go+Nodeç”Ÿæ€ç»“åˆçš„å¼€æºé¡¹ç›®
- **å‰ç«¯å›¢é˜Ÿ**ï¼šæ¸´æœ›ç°ä»£åŒ–çš„Webç®¡ç†ç•Œé¢ï¼Œè€Œä¸æ˜¯ç®€é™‹çš„åå°

### ä¸Verdaccioçš„å·®å¼‚åŒ–ä¼˜åŠ¿
| ç»´åº¦ | Grape | Verdaccio |
| :--- | :--- | :--- |
| **æŠ€æœ¯æ ˆ** | Goï¼ˆç¼–è¯‘æˆå•ä¸€äºŒè¿›åˆ¶ï¼‰ | Node.jsï¼ˆä¾èµ–npmå®‰è£…ï¼‰ |
| **å†…å­˜å ç”¨** | < 5MB | ~ 20MB |
| **å¹¶å‘èƒ½åŠ›** | é«˜ï¼ˆgoroutineï¼‰ | ä¸­ï¼ˆNode.jså•çº¿ç¨‹ï¼‰ |
| **æƒé™æ¨¡å‹** | RBAC + Webå¯è§†åŒ–ç®¡ç† | ç®€å•ACL + é…ç½®æ–‡ä»¶ |
| **æ•°æ®åº“** | PostgreSQL/MySQL/SQLite | æ–‡ä»¶ç³»ç»Ÿï¼ˆå¯æ’ä»¶æ‰©å±•ï¼‰ |
| **Web UI** | React + Ant Design | å†…ç½®ç®€å•UI |
| **ä¸­æ–‡æ”¯æŒ** | åŸç”Ÿå›½é™…åŒ– | ç¤¾åŒºç¿»è¯‘ |

---

## 2. æ ¸å¿ƒåŠŸèƒ½çŸ©é˜µ

### MVP (v0.1.0) - æœ€å°å¯è¡Œäº§å“
- [ ] **npm registry æ ¸å¿ƒAPI**
  - `GET /:package` - è·å–åŒ…å…ƒæ•°æ®
  - `GET /:package/:version` - è·å–ç‰¹å®šç‰ˆæœ¬
  - `GET /:package/-/:filename` - ä¸‹è½½tarball
- [ ] **ä¸Šæ¸¸ä»£ç†** - ç¼“å­˜å…¬å…±npmä»“åº“
- [ ] **æœ¬åœ°å­˜å‚¨** - æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨åŒ…
- [ ] **åŸºæœ¬è®¤è¯** - é™æ€tokenæˆ–ç®€å•ç”¨æˆ·è®¤è¯
- [ ] **æ”¯æŒnpm install** - å®Œæ•´çš„å·¥ä½œæµ

### v0.2.0 - å‘å¸ƒä¸å›¢é˜Ÿåä½œ
- [ ] **npm publish** - å‘å¸ƒåŒ…
- [ ] **npm unpublish** - æ’¤é”€å‘å¸ƒ
- [ ] **npm login** - ç”¨æˆ·ç™»å½•
- [ ] **npm access** - åŸºæœ¬æƒé™æ§åˆ¶
- [ ] **ç”¨æˆ·ç®¡ç†** - ç®€å•çš„ç”¨æˆ·CRUD

### v0.3.0 - ä¼ä¸šçº§æƒé™
- [ ] **RBACæƒé™æ¨¡å‹** - è§’è‰²-æƒé™-èµ„æº
- [ ] **åˆ†ç»„ç®¡ç†** - ç”¨æˆ·ç»„
- [ ] **åŒ…ä½œç”¨åŸŸï¼ˆscopeï¼‰** - @company/package
- [ ] **æ“ä½œå®¡è®¡æ—¥å¿—**
- [ ] **Webç®¡ç†åå°** - ç”¨æˆ·/æƒé™å¯è§†åŒ–é…ç½®

### v0.4.0 - å­˜å‚¨ä¸æ€§èƒ½
- [ ] **PostgreSQLæ”¯æŒ** - å…ƒæ•°æ®å­˜å‚¨
- [ ] **MinIO/S3æ”¯æŒ** - tarballå¯¹è±¡å­˜å‚¨
- [ ] **Redisç¼“å­˜** - åŠ é€Ÿå…ƒæ•°æ®è®¿é—®
- [ ] **åƒåœ¾å›æ”¶** - æ¸…ç†æœªä½¿ç”¨çš„åŒ…ç‰ˆæœ¬
- [ ] **æ€§èƒ½å‹æµ‹** - 10k+ QPS

### v1.0.0 - ç”Ÿäº§å°±ç»ª
- [ ] **é«˜å¯ç”¨éƒ¨ç½²** - é›†ç¾¤æ¨¡å¼
- [ ] **LDAP/OIDCé›†æˆ** - ä¼ä¸šç»Ÿä¸€è®¤è¯
- [ ] **Webhook** - äº‹ä»¶é€šçŸ¥
- [ ] **åŒ…å®‰å…¨æ‰«æ** - é›†æˆæ¼æ´åº“
- [ ] **å®Œå–„çš„æ–‡æ¡£** - ä¸­è‹±æ–‡åŒè¯­
- [ ] **Helm Chart** - Kuberneteséƒ¨ç½²

---

## 3. æŠ€æœ¯æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    Client[npm/yarn/pnpm/bun] --> LB[è´Ÿè½½å‡è¡¡]
    LB --> API1[Grape API Server]
    LB --> API2[Grape API Server]
    
    subgraph Grape Cluster
        API1 --> Cache[(Redis)]
        API2 --> Cache
        API1 --> DB[(PostgreSQL)]
        API2 --> DB
        API1 --> Storage[å¯¹è±¡å­˜å‚¨/MinIO]
        API2 --> Storage
    end
    
    Storage --> FS[æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ]
    Storage --> S3[(S3/OSS)]
    
    Grape --> Upstream[å…¬å…±npmä»“åº“]
```

### æŠ€æœ¯æ ˆé€‰å‹

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
| :--- | :--- | :--- |
| **åç«¯è¯­è¨€** | Go 1.21+ | é«˜æ€§èƒ½ã€å¹¶å‘ã€å•ä¸€äºŒè¿›åˆ¶ |
| **Webæ¡†æ¶** | [Gin](https://github.com/gin-gonic/gin) | é«˜æ€§èƒ½ã€ä¸­é—´ä»¶ä¸°å¯Œ |
| **æ•°æ®åº“** | PostgreSQL (ä¸») + SQLite (å¯é€‰) | ç”Ÿäº§ç¯å¢ƒç”¨PGï¼Œå¼€å‘æµ‹è¯•ç”¨SQLite |
| **å¯¹è±¡å­˜å‚¨** | [MinIO SDK](https://github.com/minio/minio-go) | å…¼å®¹S3ï¼Œå¯æœ¬åœ°éƒ¨ç½² |
| **ç¼“å­˜** | Redis | å…ƒæ•°æ®ç¼“å­˜ã€ä¼šè¯å­˜å‚¨ |
| **è®¤è¯** | JWT + [casbin](https://github.com/casbin/casbin) | JWTæ— çŠ¶æ€ï¼Œcasbinæ”¯æŒRBAC |
| **é…ç½®ç®¡ç†** | [viper](https://github.com/spf13/viper) | æ”¯æŒå¤šç§é…ç½®æ ¼å¼ |
| **æ—¥å¿—** | [zap](https://github.com/uber-go/zap) | é«˜æ€§èƒ½ç»“æ„åŒ–æ—¥å¿— |
| **å‘½ä»¤è¡Œ** | [cobra](https://github.com/spf13/cobra) | å‹å¥½çš„CLIä½“éªŒ |
| **å‰ç«¯** | React + TypeScript + Ant Design | ç°ä»£åŒ–ç»„ä»¶åº“ï¼Œä¸­æ–‡å‹å¥½ |
| **APIæ–‡æ¡£** | Swagger/OpenAPI | è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ |
| **æµ‹è¯•** | testify + ginkgo | å•å…ƒæµ‹è¯•+é›†æˆæµ‹è¯• |

### ç›®å½•ç»“æ„

```bash
grape/
â”œâ”€â”€ .github/               # GitHub Actions, ISSUEæ¨¡æ¿
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ graped/            # å®ˆæŠ¤è¿›ç¨‹ä¸»å…¥å£
â”‚   â””â”€â”€ grapectl/          # å‘½ä»¤è¡Œç®¡ç†å·¥å…·
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ api/               # HTTP API handlers
â”‚   â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ v1/            # API v1ç‰ˆæœ¬
â”‚   â”‚   â””â”€â”€ admin/         # ç®¡ç†åå°API
â”‚   â”œâ”€â”€ registry/          # npm registryæ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ metadata/      # åŒ…å…ƒæ•°æ®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tarball/       # åŒ…æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ proxy/         # ä¸Šæ¸¸ä»£ç†
â”‚   â”‚   â””â”€â”€ version/       # semverå¤„ç†
â”‚   â”œâ”€â”€ auth/              # è®¤è¯ä¸æƒé™
â”‚   â”‚   â”œâ”€â”€ model/         # ç”¨æˆ·/è§’è‰²æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ rbac/          # casbinå°è£…
â”‚   â”‚   â””â”€â”€ provider/      # LDAP/OIDCç­‰
â”‚   â”œâ”€â”€ storage/           # å­˜å‚¨æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ local/         # æœ¬åœ°æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ s3/            # S3å…¼å®¹å­˜å‚¨
â”‚   â”‚   â””â”€â”€ cache/         # Redisç¼“å­˜
â”‚   â”œâ”€â”€ db/                # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ models/        # GORMæ¨¡å‹
â”‚   â”‚   â””â”€â”€ migration/     # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ config/            # é…ç½®ç®¡ç†
â”œâ”€â”€ pkg/                   # å…¬å…±å·¥å…·åŒ…
â”‚   â”œâ”€â”€ logger/            # æ—¥å¿—å°è£…
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ constants/         # å¸¸é‡å®šä¹‰
â”œâ”€â”€ web/                   # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ admin/             # ç®¡ç†åå°
â”‚   â”œâ”€â”€ ui/                # å…¬å…±Web UI
â”‚   â””â”€â”€ public/            # é™æ€èµ„æº
â”œâ”€â”€ scripts/               # æ„å»ºè„šæœ¬
â”œâ”€â”€ test/                  # é›†æˆæµ‹è¯•
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ docker/                # Dockerç›¸å…³
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

---

## 4. æ¨¡å—åˆ’åˆ†ä¸APIè®¾è®¡

### æ ¸å¿ƒæ¨¡å—èŒè´£

| æ¨¡å— | èŒè´£ | å…³é”®æ–‡ä»¶ |
| :--- | :--- | :--- |
| **registry** | npmåè®®æ ¸å¿ƒå®ç° | `internal/registry/` |
| **auth** | è®¤è¯ã€æˆæƒã€ç”¨æˆ·ç®¡ç† | `internal/auth/` |
| **storage** | åŒ…å­˜å‚¨æŠ½è±¡ | `internal/storage/` |
| **db** | æ•°æ®åº“æ“ä½œ | `internal/db/` |
| **api** | HTTPè·¯ç”±å’Œhandler | `internal/api/` |
| **config** | é…ç½®åŠ è½½ | `internal/config/` |

### æ ¸å¿ƒAPIè®¾è®¡ (å…¼å®¹npm registry)

#### åŒ…å…ƒæ•°æ®
```http
GET /{package-name}
GET /@{scope}/{package-name}

Response 200:
{
  "name": "@grape/cli",
  "dist-tags": {
    "latest": "1.2.3",
    "beta": "2.0.0-beta.1"
  },
  "versions": {
    "1.2.3": {
      "name": "@grape/cli",
      "version": "1.2.3",
      "dist": {
        "shasum": "...",
        "tarball": "http://localhost:4873/@grape/cli/-/cli-1.2.3.tgz"
      }
    }
  },
  "time": {
    "created": "2024-01-01T00:00:00Z",
    "1.2.3": "2024-01-02T00:00:00Z"
  }
}
```

#### ä¸‹è½½tarball
```http
GET /{package-name}/-/{filename}
GET /@{scope}/{package-name}/-/{filename}
```

#### å‘å¸ƒåŒ…
```http
PUT /{package-name}
PUT /@{scope}/{package-name}

Authorization: Bearer {token}
Content-Type: application/json

{
  "_id": "@grape/cli",
  "name": "@grape/cli",
  "versions": {...},
  "_attachments": {
    "cli-1.2.3.tgz": {
      "content_type": "application/octet-stream",
      "data": "base64..."
    }
  }
}
```

#### ç”¨æˆ·è®¤è¯
```http
PUT /-/user/org.couchdb.user:{username}
Content-Type: application/json

{
  "name": "username",
  "password": "password",
  "email": "user@example.com"
}

Response:
{
  "ok": true,
  "id": "org.couchdb.user:username",
  "rev": "1-xxx",
  "token": "jwt-token-here"
}
```

#### æƒé™ç®¡ç†API (ç®¡ç†åå°)
```http
# åˆ›å»ºè§’è‰²
POST /-/api/v1/admin/roles
Authorization: Bearer {admin-token}
{
  "name": "developer",
  "permissions": [
    {"resource": "@company/*", "action": "read"},
    {"resource": "@company/*", "action": "write"}
  ]
}

# åˆ†é…è§’è‰²ç»™ç”¨æˆ·
POST /-/api/v1/admin/users/{user-id}/roles
{
  "role": "developer"
}

# åŒ…è®¿é—®æ§åˆ¶
PUT /-/api/v1/admin/packages/{package-name}/access
{
  "read": ["developer", "qa"],
  "write": ["maintainer"],
  "admin": ["admin"]
}
```

---

## 5. æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒæ•°æ®æ¨¡å‹ (PostgreSQL)

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(255),
    is_active BOOLEAN DEFAULT true,
    last_login TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- è§’è‰²è¡¨
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    is_system BOOLEAN DEFAULT false, -- ç³»ç»Ÿå†…ç½®è§’è‰²ä¸å¯åˆ é™¤
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç”¨æˆ·è§’è‰²å…³è”
CREATE TABLE user_roles (
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    role_id UUID REFERENCES roles(id) ON DELETE CASCADE,
    PRIMARY KEY (user_id, role_id)
);

-- æƒé™èµ„æºè¡¨
CREATE TABLE resources (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    pattern VARCHAR(255) NOT NULL, -- åŒ…åŒ¹é…æ¨¡å¼: "@company/*", "lodash", "react-*"
    type VARCHAR(50) DEFAULT 'package' -- package, scope, global
);

-- æƒé™è§„åˆ™è¡¨ (æ”¯æŒcasbin)
CREATE TABLE permissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    role_id UUID REFERENCES roles(id) ON DELETE CASCADE,
    resource_pattern VARCHAR(255) NOT NULL, -- åŒresources.pattern
    action VARCHAR(50) NOT NULL, -- read, write, delete, admin
    effect VARCHAR(10) DEFAULT 'allow' -- allow/deny
);

-- åŒ…å…ƒæ•°æ®è¡¨
CREATE TABLE packages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) UNIQUE NOT NULL, -- åŒ…å«scope: @scope/name
    scope VARCHAR(100),                -- @scope éƒ¨åˆ†
    is_private BOOLEAN DEFAULT true,
    description TEXT,
    readme TEXT,
    homepage VARCHAR(255),
    repository JSONB,
    bugs JSONB,
    license VARCHAR(100),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_published_at TIMESTAMP WITH TIME ZONE
);

-- åŒ…ç‰ˆæœ¬è¡¨
CREATE TABLE package_versions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    package_id UUID REFERENCES packages(id) ON DELETE CASCADE,
    version VARCHAR(50) NOT NULL,
    dist_tags JSONB DEFAULT '[]', -- ["latest", "beta"]
    metadata JSONB NOT NULL,       -- package.json å®Œæ•´å†…å®¹
    shasum VARCHAR(255) NOT NULL,
    tarball_path VARCHAR(255) NOT NULL, -- å­˜å‚¨è·¯å¾„
    tarball_size BIGINT,
    publisher_id UUID REFERENCES users(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(package_id, version)
);

-- å®¡è®¡æ—¥å¿—
CREATE TABLE audit_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    action VARCHAR(50) NOT NULL, -- publish, unpublish, access_change, login
    resource_type VARCHAR(50),   -- package, user, role
    resource_id VARCHAR(255),    -- åŒ…åæˆ–ç”¨æˆ·ID
    details JSONB,
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX idx_packages_scope ON packages(scope);
CREATE INDEX idx_package_versions_dist_tags ON package_versions USING GIN (dist_tags);
CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_created_at ON audit_logs(created_at DESC);
```

### Goè¯­è¨€æ¨¡å‹ (GORM)

```go
// internal/db/models/user.go
type User struct {
    ID           uuid.UUID      `gorm:"type:uuid;primaryKey;default:gen_random_uuid()"`
    Username     string         `gorm:"uniqueIndex;size:100;not null"`
    Email        string         `gorm:"uniqueIndex;size:255;not null"`
    PasswordHash string         `gorm:"size:255;not null"`
    FullName     string         `gorm:"size:255"`
    IsActive     bool           `gorm:"default:true"`
    LastLogin    *time.Time     
    Roles        []Role         `gorm:"many2many:user_roles;"`
    CreatedAt    time.Time      
    UpdatedAt    time.Time      
}

// internal/db/models/package.go
type Package struct {
    ID              uuid.UUID       `gorm:"type:uuid;primaryKey;default:gen_random_uuid()"`
    Name            string          `gorm:"uniqueIndex;size:255;not null"`
    Scope           string          `gorm:"size:100;index"`
    IsPrivate       bool            `gorm:"default:true"`
    Description     string          `gorm:"type:text"`
    Readme          string          `gorm:"type:text"`
    Versions        []PackageVersion
    CreatedAt       time.Time
    UpdatedAt       time.Time
    LastPublishedAt *time.Time
}

type PackageVersion struct {
    ID          uuid.UUID       `gorm:"type:uuid;primaryKey;default:gen_random_uuid()"`
    PackageID   uuid.UUID       
    Package     Package         
    Version     string          `gorm:"size:50;not null"`
    DistTags    pq.StringArray  `gorm:"type:text[]"`  // ["latest", "beta"]
    Metadata    datatypes.JSON  `gorm:"type:jsonb;not null"` // å®Œæ•´package.json
    Shasum      string          `gorm:"size:255;not null"`
    TarballPath string          `gorm:"size:255;not null"`
    TarballSize int64           
    PublisherID *uuid.UUID      
    Publisher   *User           
    CreatedAt   time.Time       
}
```

---

## 6. å¼€å‘è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¡†æ¶æ­å»º (2å‘¨)

**ç›®æ ‡**ï¼šæ­å»ºé¡¹ç›®éª¨æ¶ï¼Œè·‘é€šæœ€ç®€å•çš„`npm install`

- [x] åˆå§‹åŒ–Gitä»“åº“ï¼Œè®¾ç½®åˆ†æ”¯ä¿æŠ¤
- [ ] æ­å»ºGoé¡¹ç›®ç»“æ„
- [ ] é€‰æ‹©Webæ¡†æ¶(Gin)å¹¶é…ç½®
- [ ] å®ç°é…ç½®åŠ è½½(viper)
- [ ] å®ç°æ—¥å¿—ç³»ç»Ÿ(zap)
- [ ] **ç¬¬ä¸€è¡Œä»£ç **ï¼š`GET /` è¿”å›æ¬¢è¿é¡µé¢
- [ ] æœ€ç®€å•çš„`GET /{package}` - ä»ä¸Šæ¸¸ä»£ç†è¿”å›æ•°æ®
- [ ] å®ç°`GET /{package}/-/{filename}` - ä¸‹è½½tarball
- [ ] å®ç°æœ¬åœ°ç¼“å­˜æœºåˆ¶
- [ ] **éªŒè¯**ï¼š`npm install react` èƒ½æˆåŠŸ

### é˜¶æ®µäºŒï¼šæœ¬åœ°å‘å¸ƒèƒ½åŠ› (3å‘¨)

**ç›®æ ‡**ï¼šæ”¯æŒ`npm publish`ï¼Œå®ç°æœ¬åœ°ç§æœ‰åŒ…ç®¡ç†

- [ ] å®ç°æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ(local)
- [ ] å®ç°`PUT /{package}` - å‘å¸ƒåŒ…
- [ ] å®ç°tarballè§£å‹å’Œå…ƒæ•°æ®æå–
- [ ] å®ç°ç”¨æˆ·è®¤è¯åŸºç¡€ï¼ˆå†…å­˜ç”¨æˆ·ï¼‰
- [ ] å®ç°`npm login`æµç¨‹
- [ ] å®ç°`npm unpublish`ï¼ˆè½¯åˆ é™¤ï¼‰
- [ ] å®ç°åŒ…ç‰ˆæœ¬ç®¡ç†ï¼ˆsemverè§£æï¼‰
- [ ] **éªŒè¯**ï¼šèƒ½å‘å¸ƒç§æœ‰åŒ…ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªé¡¹ç›®`npm install`æˆåŠŸ

### é˜¶æ®µä¸‰ï¼šæ•°æ®åº“é›†æˆ (2å‘¨)

**ç›®æ ‡**ï¼šä»æ–‡ä»¶ç³»ç»Ÿè¿ç§»åˆ°æ•°æ®åº“ï¼Œä¸ºæƒé™ç³»ç»Ÿåšå‡†å¤‡

- [ ] é›†æˆGORM
- [ ] æ”¯æŒSQLiteï¼ˆå¼€å‘/æµ‹è¯•ï¼‰
- [ ] æ”¯æŒPostgreSQLï¼ˆç”Ÿäº§ï¼‰
- [ ] è®¾è®¡å¹¶å®ç°æ•°æ®åº“è¿ç§»å·¥å…·
- [ ] å°†åŒ…å…ƒæ•°æ®è¿ç§»åˆ°æ•°æ®åº“
- [ ] å°†ç”¨æˆ·æ•°æ®è¿ç§»åˆ°æ•°æ®åº“
- [ ] å®ç°æ•°æ®åº“å­˜å‚¨å±‚
- [ ] **éªŒè¯**ï¼šé‡å¯æœåŠ¡åæ•°æ®ä¸ä¸¢å¤±

### é˜¶æ®µå››ï¼šæƒé™ç³»ç»Ÿ (3å‘¨)

**ç›®æ ‡**ï¼šå®ç°ä¼ä¸šçº§RBACæƒé™æ§åˆ¶

- [ ] é›†æˆcasbin
- [ ] è®¾è®¡æƒé™æ¨¡å‹ï¼ˆç”¨æˆ·-è§’è‰²-èµ„æºï¼‰
- [ ] å®ç°`npm access`å‘½ä»¤æ”¯æŒ
- [ ] å®ç°åŒ…ä½œç”¨åŸŸ(scope)æƒé™æ§åˆ¶
- [ ] å®ç°ç®¡ç†åå°APIï¼ˆç”¨æˆ·/è§’è‰²CRUDï¼‰
- [ ] å®ç°å®¡è®¡æ—¥å¿—
- [ ] æƒé™ç›¸å…³æµ‹è¯•ç”¨ä¾‹
- [ ] **éªŒè¯**ï¼šç”¨æˆ·Aä¸èƒ½å‘å¸ƒç”¨æˆ·Bçš„åŒ…

### é˜¶æ®µäº”ï¼šWeb UI (4å‘¨)

**ç›®æ ‡**ï¼šç°ä»£åŒ–ç®¡ç†åå° + å…¬å…±åŒ…æµè§ˆç•Œé¢

- [ ] åˆå§‹åŒ–React + TypeScripté¡¹ç›®
- [ ] é›†æˆAnt Designç»„ä»¶åº“
- [ ] å®ç°ç™»å½•é¡µé¢
- [ ] å®ç°ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼ˆåˆ—è¡¨/åˆ›å»º/ç¼–è¾‘ï¼‰
- [ ] å®ç°è§’è‰²ç®¡ç†ç•Œé¢
- [ ] å®ç°åŒ…æµè§ˆç•Œé¢ï¼ˆç±»ä¼¼npmjs.comï¼‰
- [ ] å®ç°åŒ…æƒé™é…ç½®ç•Œé¢
- [ ] å®ç°å®¡è®¡æ—¥å¿—æŸ¥çœ‹
- [ ] å®ç°æš—è‰²ä¸»é¢˜
- [ ] å›½é™…åŒ–æ”¯æŒï¼ˆä¸­/è‹±æ–‡ï¼‰
- [ ] **éªŒè¯**ï¼šç®¡ç†å‘˜èƒ½åœ¨ç•Œé¢ä¸Šåˆ›å»ºç”¨æˆ·å¹¶åˆ†é…æƒé™

### é˜¶æ®µå…­ï¼šæ€§èƒ½ä¼˜åŒ–ä¸ç”Ÿæ€ (3å‘¨)

**ç›®æ ‡**ï¼šè®©GrapeçœŸæ­£"è½»ç›ˆå¦‚é£"

- [ ] é›†æˆRedisç¼“å­˜
- [ ] å®ç°å¯¹è±¡å­˜å‚¨æ”¯æŒï¼ˆMinIO/S3ï¼‰
- [ ] å®ç°åŒ…åƒåœ¾å›æ”¶
- [ ] æ€§èƒ½å‹æµ‹ï¼ˆwrk/k6ï¼‰
- [ ] ä¼˜åŒ–å¹¶å‘å¤„ç†ï¼ˆgoroutineæ± ï¼‰
- [ ] Dockeré•œåƒåˆ¶ä½œ
- [ ] Docker Composeä¸€é”®éƒ¨ç½²
- [ ] Helm Chart for Kubernetes
- [ ] **éªŒè¯**ï¼š100å¹¶å‘ä¸‹`npm install`å“åº”æ—¶é—´<200ms

### é˜¶æ®µä¸ƒï¼šç”Ÿäº§å°±ç»ª (æŒç»­)

**ç›®æ ‡**ï¼šè®©ä¼ä¸šæ”¾å¿ƒä½¿ç”¨

- [ ] å®Œæ•´çš„æ–‡æ¡£ï¼ˆä¸­è‹±æ–‡ï¼‰
- [ ] æ›´å¤šè®¤è¯æ–¹å¼ï¼ˆLDAPã€OIDCï¼‰
- [ ] é«˜å¯ç”¨é›†ç¾¤æ”¯æŒ
- [ ] Webhookäº‹ä»¶é€šçŸ¥
- [ ] åŒ…å®‰å…¨æ‰«æé›†æˆ
- [ ] Prometheusç›‘æ§æŒ‡æ ‡
- [ ] å®Œæˆå¼€æºåè®®ï¼ˆApache 2.0ï¼‰
- [ ] å®˜ç½‘å»ºè®¾ï¼ˆgrape.devï¼‰
- [ ] ç¤¾åŒºè¿è¥ï¼ˆDiscordã€å¾®ä¿¡ç¾¤ï¼‰

---

## 7. ç¤¾åŒºä¸å¼€æºç­–ç•¥

### GitHubç»„ç»‡è®¾ç½®

```
graperegistry/
â”œâ”€â”€ grape           # ä¸»ä»“åº“
â”œâ”€â”€ website         # å®˜ç½‘æºç 
â”œâ”€â”€ docs            # æ–‡æ¡£ä»“åº“
â”œâ”€â”€ helm-charts     # Kuberneteséƒ¨ç½²
â”œâ”€â”€ homebrew-grape  # Macå®‰è£…æ”¯æŒ
â””â”€â”€ community       # ç¤¾åŒºè®¨è®º/RFC
```

### å¼€æºåè®®
- **Apache 2.0** - å…è®¸å•†ä¸šä½¿ç”¨ï¼Œä¿æŠ¤è´¡çŒ®è€…

### è´¡çŒ®æŒ‡å—

```markdown
# è´¡çŒ®æŒ‡å—

## æ–°æ‰‹ä»»åŠ¡
- [good first issue](link) - é€‚åˆæ–°æ‰‹çš„ä»»åŠ¡
- [help wanted](link) - éœ€è¦å¸®åŠ©çš„ä»»åŠ¡

## å¼€å‘ç¯å¢ƒæ­å»º
1. Fork ä»“åº“
2. `make setup` - å®‰è£…ä¾èµ–
3. `make dev` - å¯åŠ¨å¼€å‘ç¯å¢ƒ
4. `make test` - è¿è¡Œæµ‹è¯•

## æäº¤PRæµç¨‹
- ä»mainåˆ†æ”¯åˆ›å»ºfeatureåˆ†æ”¯
- éµå¾ªCommitè§„èŒƒï¼ˆconventional commitsï¼‰
- é€šè¿‡æ‰€æœ‰CIæ£€æŸ¥
- è‡³å°‘1ä¸ªrevieweræ‰¹å‡†
```

### ç¤¾åŒºè¿è¥è®¡åˆ’

| é˜¶æ®µ | ç›®æ ‡ | åŠ¨ä½œ |
| :--- | :--- | :--- |
| **å†·å¯åŠ¨** | å¸å¼•æ—©æœŸè´¡çŒ®è€… | - å‘å¸ƒæŠ€æœ¯é¢„è§ˆç‰ˆ<br>- åœ¨Goç¤¾åŒºï¼ˆGolangä¸­å›½ã€GopherChinaï¼‰å®£ä¼ <br>- å†™æŠ€æœ¯æ–‡ç« ã€Šç”¨Goé‡å†™npmç§æœã€‹ |
| **æˆé•¿** | å»ºç«‹æ ¸å¿ƒè´¡çŒ®è€…å›¢é˜Ÿ | - æ¯æœˆç¤¾åŒºä¼šè®®<br>- è®¾ç«‹Contributor Ladder<br>- ä¸¾åŠWorkshop |
| **æˆç†Ÿ** | å½¢æˆç”Ÿæ€ | - æ’ä»¶æœºåˆ¶<br>- ä¼ä¸šç”¨æˆ·æ¡ˆä¾‹<br>- å•†ä¸šåŒ–æ¢ç´¢ï¼ˆå¯é€‰ï¼‰ |

---

## 8. å“ç‰Œä¸è§†è§‰è®¾è®¡

### Logoè®¾è®¡æ€è·¯

**ä¸»Logo**ï¼šä¸€ä¸²è‘¡è„ ğŸ‡
- ç´«è‰²æ¸å˜ï¼Œè±¡å¾é«˜è´µä¸ç§‘æŠ€æ„Ÿ
- æ¯é¢—è‘¡è„å¯ä»¥ä»£è¡¨ä¸€ä¸ªnpmåŒ…
- è‘¡è„ä¸²çš„å½¢çŠ¶åƒä¾èµ–æ ‘

**å¤‡é€‰æ–¹æ¡ˆ**ï¼š
- å•é¢—è‘¡è„ + äºŒè¿›åˆ¶ä»£ç çº¹ç†
- è‘¡è„è—¤ç¼ ç»•æˆ"G"å­—å½¢

### è‰²å½©ç³»ç»Ÿ

```css
:root {
  --grape-primary: #6f2da8;      /* è‘¡è„ç´« */
  --grape-secondary: #9b4dcb;     /* æµ…ç´« */
  --grape-accent: #4caf50;        /* è‘¡è„å¶ç»¿ */
  --grape-bg: #f8f5ff;            /* èƒŒæ™¯è‰² */
  --grape-text: #2d2d2d;           /* æ–‡å­—è‰² */
}
```

### å£å·å˜ä½“

- **è‹±æ–‡**ï¼šLightweight npm registry, heavyweight features.
- **ä¸­æ–‡**ï¼šè½»ç›ˆå¦‚é£ï¼ŒåŠŸèƒ½å¦‚å±±ã€‚
- **æç®€**ï¼šOne binary, zero debt.

### å®˜ç½‘è®¾è®¡ (grape.dev)

- **é¦–é¡µ**ï¼šè‹±é›„åŒº + ç‰¹æ€§å±•ç¤º + å¿«é€Ÿå¼€å§‹
- **æ–‡æ¡£**ï¼šå®‰è£…/é…ç½®/API/æƒé™æŒ‡å—
- **åšå®¢**ï¼šæŠ€æœ¯åˆ†äº«ã€ç‰ˆæœ¬å‘å¸ƒ
- **ç¤¾åŒº**ï¼šGitHubã€Discordå…¥å£

---

## 9. é‡Œç¨‹ç¢‘ä¸å‘å¸ƒè®¡åˆ’

### ç‰ˆæœ¬å‘½åè§„èŒƒ
éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼š`vä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.è¡¥ä¸`

### å‘å¸ƒè®¡åˆ’

| ç‰ˆæœ¬ | æ—¶é—´ | ä¸»è¦ç‰¹æ€§ | ç›®æ ‡ç”¨æˆ· |
| :--- | :--- | :--- | :--- |
| **v0.1.0-alpha** | ç¬¬6å‘¨ | åŸºç¡€ä»£ç†åŠŸèƒ½ | æ—©æœŸå°é²œè€… |
| **v0.2.0-beta** | ç¬¬10å‘¨ | å‘å¸ƒåŠŸèƒ½ + è®¤è¯ | å¼€å‘è€…æµ‹è¯• |
| **v0.3.0-beta** | ç¬¬14å‘¨ | æƒé™ç³»ç»Ÿ | ä¼ä¸šè¯•ç”¨ |
| **v0.4.0-rc** | ç¬¬18å‘¨ | Web UI + æ•°æ®åº“ | ç¤¾åŒºåé¦ˆ |
| **v1.0.0** | ç¬¬24å‘¨ | ç”Ÿäº§å°±ç»ª | æ­£å¼å‘å¸ƒ |

### å…³é”®èŠ‚ç‚¹

- **Day 1**ï¼šGitHubä»“åº“å…¬å¼€ï¼ŒREADMEå‘å¸ƒ
- **Week 2**ï¼šç¬¬ä¸€ä¸ªå¯ç”¨ç‰ˆæœ¬ï¼Œè·‘é€š`npm install`
- **Week 6**ï¼šv0.1.0-alpha å‘å¸ƒï¼Œæ‹›å‹Ÿå†…æµ‹ç”¨æˆ·
- **Week 12**ï¼šé¦–ä¸ªä¼ä¸šç”¨æˆ·è¯•ç”¨
- **Week 24**ï¼šv1.0.0 æ­£å¼å‘å¸ƒï¼Œå®˜ç½‘ä¸Šçº¿

---

## ğŸš€ ç«‹å³è¡ŒåŠ¨æ¸…å•

### ä»Šå¤©è¦åšçš„äº‹

- [ ] **æ³¨å†ŒGitHubç»„ç»‡**ï¼š`graperegistry`
- [ ] **åˆ›å»ºä¸»ä»“åº“**ï¼š`grape`
- [ ] **ç¼–å†™README.md**ï¼šé¡¹ç›®ä»‹ç» + æ„¿æ™¯ + å¿«é€Ÿå¼€å§‹
- [ ] **é€‰æ‹©å¼€æºåè®®**ï¼šæ·»åŠ LICENSEæ–‡ä»¶ï¼ˆApache 2.0ï¼‰
- [ ] **åˆå§‹åŒ–Goé¡¹ç›®**ï¼š`go mod init github.com/graperegistry/grape`
- [ ] **æäº¤ç¬¬ä¸€ä¸ªcommit**ï¼šåŒ…å«é¡¹ç›®ç»“æ„å’Œ"Hello World" API
- [ ] **æ³¨å†ŒåŸŸå**ï¼šgrape.devï¼ˆæˆ– .io .orgï¼‰
- [ ] **åˆ›å»ºç¤¾äº¤è´¦å·**ï¼šTwitter @graperegistry

### æœ¬å‘¨å†…

- [ ] å®Œæˆé˜¶æ®µä¸€çš„åŸºç¡€æ¡†æ¶
- [ ] å®ç°æœ€ç®€å•çš„`npm install`ä»£ç†
- [ ] å†™ä¸€ç¯‡æŠ€æœ¯åšå®¢ã€Šä¸ºä»€ä¹ˆç”¨Goé‡å†™npmç§æœã€‹
- [ ] åœ¨Goç¤¾åŒºå‘å¸–å¯»æ‰¾æ—©æœŸè´¡çŒ®è€…

### æœ¬æœˆå†…

- [ ] å‘å¸ƒv0.1.0-alpha
- [ ] å»ºç«‹ç¤¾åŒºå¾®ä¿¡ç¾¤/Discord
- [ ] ç¡®å®šæ ¸å¿ƒè´¡çŒ®è€…å›¢é˜Ÿ

---

## ğŸ’¬ æœ€åçš„è¯

**Grape** ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯é¡¹ç›®ï¼Œå®ƒæœ‰æœºä¼šæˆä¸ºGoç”Ÿæ€ä¸­ç¬¬ä¸€ä¸ªçœŸæ­£æˆç†Ÿçš„npm registryå®ç°ã€‚è¿™æ¡è·¯ä¸å®¹æ˜“ï¼Œä½†éå¸¸æœ‰ä»·å€¼ï¼š

- å¯¹**ç¤¾åŒº**ï¼šå¡«è¡¥Goç”Ÿæ€ç©ºç™½
- å¯¹**ä¼ä¸š**ï¼šæä¾›ä¸€ä¸ªæ›´è½»é‡ã€æ›´å¯æ§çš„é€‰æ‹©
- å¯¹**ä½ è‡ªå·±**ï¼šä¸€ä¸ªå¯ä»¥é•¿æœŸç»è¥çš„å¼€æºä½œå“

è®°ä½å¼€æºçš„é»„é‡‘æ³•åˆ™ï¼š**æ—©å‘å¸ƒï¼Œå¸¸å‘å¸ƒï¼Œå€¾å¬ç¤¾åŒº**ã€‚ä¸è¦ç­‰æ‰€æœ‰åŠŸèƒ½éƒ½å®Œç¾äº†æ‰å‘å¸ƒï¼Œä»ç¬¬ä¸€å¤©å°±å¼€å§‹è®©ç”¨æˆ·å‚ä¸è¿›æ¥ã€‚

**ç°åœ¨ï¼Œå»åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªcommitå§ï¼** ğŸ‡

---

æ¥ä¸‹æ¥ä½ æƒ³å…ˆæ·±å…¥å“ªä¸ªéƒ¨åˆ†ï¼Ÿæˆ‘ä»¬å¯ä»¥ç»§ç»­è®¨è®ºï¼š
1. **æŠ€æœ¯ç»†èŠ‚**ï¼šæ¯”å¦‚å¦‚ä½•å®ç°npmåè®®çš„æ ¸å¿ƒé€»è¾‘ï¼Ÿ
2. **å¼€å‘ç¯å¢ƒ**ï¼šéœ€è¦å¸®å¿™æ­å»ºCI/CDå—ï¼Ÿ
3. **ç¤¾åŒºè¿è¥**ï¼šå¦‚ä½•å¸å¼•ç¬¬ä¸€æ‰¹è´¡çŒ®è€…ï¼Ÿ
4. **å…¶ä»–**ï¼šä»»ä½•ä½ å…³å¿ƒçš„é—®é¢˜